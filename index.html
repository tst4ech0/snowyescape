<!doctype html><meta charset=utf-8><title>DT Snowmaze</title>
<style>*{box-sizing:border-box}body{margin:0;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#022;color:#cff;font-family:monospace}#top{width:100%;text-align:center;padding:6px 0;font-size:13px}canvas{image-rendering:pixelated;border:8px solid #012}#ui{position:fixed;right:8px;top:8px;display:flex;flex-direction:column;gap:8px}button{border:0;background:#044;color:#cff;border-radius:6px;padding:6px;font-size:14px}#mobileCtl{position:fixed;left:8px;bottom:8px;display:grid;grid-template-columns:56px 56px 56px;gap:8px}#mobileCtl button{width:56px;height:56px;border-radius:8px;font-size:20px}label{font-size:12px;color:#9fe}</style>

<div id=top>Collect <b>D</b> &amp; <b>T</b> then reach the center to escape</div>
<canvas id=c></canvas>

<div id=ui>
  <div><label>Difficulty <span id=val>50</span></label></div>
  <input id=slider type=range min=1 max=100 value=50>
  <div style="display:flex;gap:6px">
    <button id=regen>Regenerate</button>
    <button id=auto>Randomize</button>
  </div>
</div>

<div id=mobileCtl>
  <div></div><button id=up>↑</button><div></div>
  <button id=left>←</button><button id=down>↓</button><button id=right>→</button>
</div>

<script>
const cv=document.getElementById('c'),ctx=cv.getContext('2d'),slider=document.getElementById('slider'),val=document.getElementById('val');
let sVal=+slider.value;
val.textContent=sVal;

let seed=Date.now()%1e9; function rnd(){seed=(1103515245*seed+12345)|0;return ((seed>>>0)%1e9)/1e9}

let N,cell,W,cx,cy,mask,grid,D,T,player,gotD,gotT,colExit;

const MINN=11, MAXN=63; // odd sizes; mapping 1->MINN,100->MAXN
function sliderToN(v){
  let n=Math.floor(MINN + ((v-1)/99)*(MAXN-MINN));
  if(n%2==0) n++; return n;
}

function makeMask(){
 mask=Array.from({length:N},()=>Array(N).fill(false));
 const wedgeAngle=2*Math.PI/6, rmax=cx-1;
 const wedge=Array.from({length:N},()=>Array(N).fill(false));
 for(let y=0;y<N;y++)for(let x=0;x<N;x++){
  let dx=x-cx,dy=y-cy,r=Math.hypot(dx,dy); if(r>rmax) continue;
  let a=Math.atan2(dy,dx), a0=(a+Math.PI*2)%(wedgeAngle), fr=a0/wedgeAngle;
  if(r < rmax*(0.45+0.45*rnd()*Math.abs(Math.sin(fr*6))+0.08)) wedge[y][x]=true;
 }
 for(let y=0;y<N;y++)for(let x=0;x<N;x++) if(wedge[y][x]){
  let dx=x-cx,dy=y-cy,ang=Math.atan2(dy,dx),rad=Math.hypot(dx,dy);
  for(let k=0;k<6;k++){ let a=ang + k*wedgeAngle; let rx=Math.round(cx + Math.cos(a)*rad), ry=Math.round(cy + Math.sin(a)*rad);
   if(rx>=0&&ry>=0&&rx<N&&ry<N) mask[ry][rx]=true;
  }
 }
 if(!mask[cy][cx]) mask[cy][cx]=true;
}

function carveMaze(){
 grid=Array.from({length:N},()=>Array(N).fill(1));
 const stack=[]; grid[cy][cx]=0; stack.push([cx,cy]);
 function inMask(x,y){ return x>0&&y>0&&x<N-1&&y<N-1 && mask[y] && mask[y][x]; }
 while(stack.length){
  let [x,y]=stack[stack.length-1],dirs=[];
  [[2,0],[-2,0],[0,2],[0,-2]].forEach(d=>{let nx=x+d[0],ny=y+d[1]; if(inMask(nx,ny)&&grid[ny][nx]) dirs.push(d)});
  if(dirs.length){ let d=dirs[(rnd()*dirs.length)|0],nx=x+d[0],ny=y+d[1]; grid[ny][nx]=0; grid[y+d[1]/2][x+d[0]/2]=0; stack.push([nx,ny]); } else stack.pop();
 }
}

function placeEntities(){
 const pts=[]; for(let y=0;y<N;y++)for(let x=0;x<N;x++) if(grid[y][x]==0 && !(x==cx&&y==cy)) pts.push([x,y]);
 D=pts[(rnd()*pts.length)|0]; T=pts[(rnd()*pts.length)|0];
 while(D[0]==T[0]&&D[1]==T[1]) T=pts[(rnd()*pts.length)|0];
 player=[cx,cy];
 // start player near edge: search outward ring
 outer: for(let r=1;r<N;r++){ for(let i=0;i<N;i++){ let x=i,y=r; if(grid[y]?.[x]==0){player=[x,y]; break outer;} } }
 gotD=gotT=colExit=false;
}

function regen(){
 N=sliderToN(sVal); cell=Math.max(6, Math.floor(322/N)); W=N*cell; cv.width=cv.height=W; cx=N>>1; cy=cx;
 seed=(Date.now()%1e9)||123;
 makeMask(); carveMaze(); placeEntities(); draw();
}

function draw(){
 ctx.clearRect(0,0,W,W);
 // snowflake background
 for(let y=0;y<N;y++)for(let x=0;x<N;x++) if(mask[y][x]) ctx.fillStyle='#023',ctx.fillRect(x*cell,y*cell,cell,cell);
 // maze
 for(let y=0;y<N;y++)for(let x=0;x<N;x++){
  let px=x*cell,py=y*cell;
  if(grid[y][x]) ctx.fillStyle='#044',ctx.fillRect(px,py,cell,cell);
  else ctx.fillStyle='#013',ctx.fillRect(px+1,py+1,cell-2,cell-2);
 }
 // outline
 ctx.strokeStyle='#7ff'; ctx.lineWidth=Math.max(1,cell/6); ctx.beginPath();
 for(let y=0;y<N;y++)for(let x=0;x<N;x++) if(mask[y][x] && (!mask[y+1]?.[x]||!mask[y-1]?.[x]||!mask[y]?.[x+1]||!mask[y]?.[x-1])) ctx.rect(x*cell,y*cell,cell,cell);
 ctx.stroke();
 // letters
 ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font='bold '+(cell-2)+'px monospace';
 if(!gotD){ ctx.fillStyle='#ff8'; ctx.fillText('D', D[0]*cell+cell/2, D[1]*cell+cell/2) }
 if(!gotT){ ctx.fillStyle='#ff8'; ctx.fillText('T', T[0]*cell+cell/2, T[1]*cell+cell/2) }
 // exit
 ctx.fillStyle=colExit? '#8f8':'#f88'; ctx.fillText('⟲', cx*cell+cell/2, cy*cell+cell/2);
 // player
 ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(player[0]*cell+cell/2,player[1]*cell+cell/2,cell/3,0,7); ctx.fill();
 // HUD
 ctx.fillStyle='#cff'; ctx.font='12px monospace'; ctx.textAlign='left';
 ctx.fillText('Found: '+(gotD? 'D ':'')+(gotT? 'T':''),6,14);
}

function move(dx,dy){
 let nx=player[0]+dx,ny=player[1]+dy; if(nx<0||ny<0||nx>=N||ny>=N) return; if(grid[ny][nx]) return;
 player=[nx,ny];
 if(player[0]==D[0]&&player[1]==D[1]) gotD=true;
 if(player[0]==T[0]&&player[1]==T[1]) gotT=true;
 if(gotD&&gotT) colExit=true;
 if(player[0]==cx&&player[1]==cy&&colExit){ setTimeout(()=>{alert('You escaped the snowmaze!'); regen()},10) }
 draw();
}

// keyboard
window.addEventListener('keydown',e=>{const k=e.key;if(k==='ArrowLeft'||k==='a')move(-1,0);else if(k==='ArrowRight'||k==='d')move(1,0);else if(k==='ArrowUp'||k==='w')move(0,-1);else if(k==='ArrowDown'||k==='s')move(0,1)});
// on-screen buttons
document.getElementById('up').addEventListener('click',()=>move(0,-1));
document.getElementById('down').addEventListener('click',()=>move(0,1));
document.getElementById('left').addEventListener('click',()=>move(-1,0));
document.getElementById('right').addEventListener('click',()=>move(1,0));
// swipe
let sx,sy; cv.addEventListener('touchstart',e=>{let t=e.touches[0];sx=t.clientX;sy=t.clientY});
cv.addEventListener('touchend',e=>{let t=e.changedTouches[0];let dx=t.clientX-sx,dy=t.clientY-sy; if(Math.hypot(dx,dy)<18) return; if(Math.abs(dx)>Math.abs(dy)) move(dx>0?1:-1,0); else move(0,dy>0?1:-1)},false);

// ui handlers
slider.addEventListener('input',e=>{sVal=+e.target.value; val.textContent=sVal});
document.getElementById('regen').addEventListener('click',regen);
document.getElementById('auto').addEventListener('click',()=>{seed=Math.floor(Math.random()*1e9); regen()});

// initial
regen();
</script>